name: raku Nightly Rebuild

on:
  # Trigger the workflow every night at 4:00 AM UTC
  schedule:
    - cron: '40 4 * * *'

  # Allows to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  run-tests-on-local-machine:
    runs-on: self-hosted

    steps:
      # Check out repository's code onto local machine
      - name: Check out code
        uses: actions/checkout@v4

      # Testing command
      - name: Build images
        run: |
          echo "Building images"
          cd docker/raku
          make
          if [ 0 -eq 0 ]; then
              make test > /dev/null 2> /dev/null
              if [ 0 -eq 0 ]; then
                  printf \033[32mOK\033[0m"\n"
                  push_to_registry  fderepas latest
              else
                  printf \033[31mtest_\KO\033[0m"\n"
              fi
          else
              printf \033[31mKO\033[0m"\n"
              exit 1
          fi
